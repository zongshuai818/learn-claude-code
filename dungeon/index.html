<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>地下城与智能体</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="game-container">
      <!-- Header -->
      <header class="game-header">
        <div class="mascot-wrapper">
          <div class="header-mascot" id="header-princess"></div>
        </div>
        <h1 class="game-title">地下城与智能体</h1>
        <div class="mascot-wrapper">
          <div class="header-mascot" id="header-robot"></div>
        </div>
      </header>

      <!-- Left Sidebar: Status Panel -->
      <aside class="status-panel pixel-box">
        <div class="panel-section">
          <h2 class="panel-title">状态</h2>
          <div class="hp-display">
            <span class="hp-label">生命值</span>
            <div class="hp-bar" id="hp-bar"></div>
            <span class="hp-text" id="hp-text">20/20</span>
          </div>
        </div>

        <div class="panel-section">
          <h3 class="panel-subtitle">位置</h3>
          <p class="location-name" id="location-name">洞穴入口</p>
          <div class="map-container">
            <div class="pixel-map" id="pixel-map"></div>
          </div>
          <div class="map-legend">
            <span class="legend-item"
              ><span class="legend-swatch current"></span> 你</span
            >
            <span class="legend-item"
              ><span class="legend-swatch visited"></span> 已访问</span
            >
            <span class="legend-item"
              ><span class="legend-swatch unknown"></span> 未知</span
            >
          </div>
        </div>

        <div class="panel-section">
          <h3 class="panel-subtitle">物品清单</h3>
          <ul class="inventory-list" id="inventory-list">
            <li class="inventory-empty">空</li>
          </ul>
        </div>

        <div class="panel-section">
          <h3 class="panel-subtitle">操作</h3>
          <div class="button-grid">
            <button class="pixel-btn" data-cmd="look" title="L" disabled>
              <span class="btn-icon">👁</span> 查看
            </button>
            <button class="pixel-btn" data-cmd="inventory" title="I" disabled>
              <span class="btn-icon">🎒</span> 物品
            </button>
            <button class="pixel-btn" data-cmd="help" title="H" disabled>
              <span class="btn-icon">📜</span> 帮助
            </button>
            <button class="pixel-btn" id="talk-btn" disabled>
              <span class="btn-icon">💬</span> 对话
            </button>
            <button class="pixel-btn" id="take-btn" disabled>
              <span class="btn-icon">✋</span> 拾取
            </button>
            <button
              class="pixel-btn pixel-btn-combat"
              data-cmd="attack"
              title="A"
              id="attack-btn"
              disabled
            >
              <span class="btn-icon">🗡️</span> 攻击
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="main-panel">
        <!-- Portrait Area (shown during conversations) -->
        <div
          class="portrait-container pixel-box"
          id="portrait-container"
          hidden
        >
          <div class="portrait-frame">
            <div class="portrait-art" id="portrait-art"></div>
          </div>
          <div class="portrait-info">
            <span class="portrait-name" id="portrait-name"></span>
            <span class="portrait-trait" id="portrait-trait"></span>
          </div>
          <button class="portrait-close" id="portrait-close">X</button>
        </div>

        <!-- Room Items Display -->
        <div class="items-bar pixel-box" id="items-bar" hidden>
          <span class="items-title">物品：</span>
          <div class="items-list" id="items-list"></div>
        </div>

        <!-- Game Output -->
        <div class="output-container pixel-box">
          <div class="output" id="output">
            <p class="system">输入 'help' 查看可用命令。</p>
            <p class="system">---</p>
          </div>
        </div>

        <!-- Input Area -->
        <div class="input-area pixel-box">
          <span class="input-prompt">&gt;</span>
          <input
            type="text"
            id="command"
            placeholder="输入命令..."
            autofocus
            autocomplete="off"
            spellcheck="false"
          />
        </div>
      </main>
    </div>

    <!-- Scanline overlay -->
    <div class="scanlines"></div>

    <script src="ui/portraits.js"></script>
    <script src="ui/ui.js"></script>
    <script src="game.js"></script>
    <script>
      // Live reload
      ;(function () {
        const es = new EventSource("/live-reload")
        es.onmessage = (e) => {
          if (e.data === "reload") location.reload()
        }
      })()
    </script>
  </body>
</html>
